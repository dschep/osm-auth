var osmAuth=(function(){var Se=Object.create;var k=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var g=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},Fe=function(e,t){for(var r in t)k(e,r,{get:t[r],enumerable:!0})},U=function(e,t,r,i){if(t&&typeof t=="object"||typeof t=="function")for(var a=Ae(t),o=0,l=a.length,u;o<l;o++)u=a[o],!je.call(e,u)&&u!==r&&k(e,u,{get:function(n){return t[n]}.bind(null,u),enumerable:!(i=Oe(t,u))||i.enumerable});return e};var Te=function(e,t,r){return r=e!=null?Se(Pe(e)):{},U(t||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e)},ke=function(e){return U(k({},"__esModule",{value:!0}),e)};var w=g(function(Gt,B){var J=Ne(),qe=Ce(),Ee=Ie(),Je=typeof window!="undefined"?window:global;B.exports={assign:J,create:qe,trim:Ee,bind:Ge,slice:N,each:$,map:Me,pluck:C,isList:I,isFunction:Re,isObject:ze,Global:Je};function Ne(){return Object.assign?Object.assign:function(t,r,i,a){for(var o=1;o<arguments.length;o++)$(Object(arguments[o]),function(l,u){t[u]=l});return t}}function Ce(){if(Object.create)return function(r,i,a,o){var l=N(arguments,1);return J.apply(this,[Object.create(r)].concat(l))};var t=function(){},e=t;return function(i,a,o,l){var u=N(arguments,1);return t.prototype=i,J.apply(this,[new t].concat(u))}}function Ie(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function Ge(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function N(e,t){return Array.prototype.slice.call(e,t||0)}function $(e,t){C(e,function(r,i){return t(r,i),!1})}function Me(e,t){var r=I(e)?[]:{};return C(e,function(i,a){return r[a]=t(i,a),!1}),r}function C(e,t){if(I(e)){for(var r=0;r<e.length;r++)if(t(e[r],r))return e[r]}else for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))return e[i]}function I(e){return e!=null&&typeof e!="function"&&typeof e.length=="number"}function Re(e){return e&&{}.toString.call(e)==="[object Function]"}function ze(e){return e&&{}.toString.call(e)==="[object Object]"}});var W=g(function(Mt,X){var v=w(),Le=v.slice,De=v.pluck,y=v.each,Ue=v.bind,$e=v.create,G=v.isList,M=v.isFunction,Be=v.isObject;X.exports={createStore:R};var Xe={version:"2.0.12",enabled:!1,get:function(e,t){var r=this.storage.read(this._namespacePrefix+e);return this._deserialize(r,t)},set:function(e,t){return t===void 0?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(r,i){e.call(t,t._deserialize(r),(i||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return R.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return R(this.storage,this.plugins,e)}};function We(){var e=typeof console=="undefined"?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function R(e,t,r){r||(r=""),e&&!G(e)&&(e=[e]),t&&!G(t)&&(t=[t]);var i=r?"__storejs_"+r+"_":"",a=r?new RegExp("^"+i):null,o=/^[a-zA-Z0-9_\-]*$/;if(!o.test(r))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var l={_namespacePrefix:i,_namespaceRegexp:a,_testStorage:function(n){try{var s="__storejs__test__";n.write(s,s);var c=n.read(s)===s;return n.remove(s),c}catch(d){return!1}},_assignPluginFnProp:function(n,s){var c=this[s];this[s]=function(){var p=Le(arguments,0),m=this;function h(){if(c)return y(arguments,function(E,ye){p[ye]=E}),c.apply(m,p)}var _=[h].concat(p);return n.apply(m,_)}},_serialize:function(n){return JSON.stringify(n)},_deserialize:function(n,s){if(!n)return s;var c="";try{c=JSON.parse(n)}catch(d){c=n}return c!==void 0?c:s},_addStorage:function(n){this.enabled||this._testStorage(n)&&(this.storage=n,this.enabled=!0)},_addPlugin:function(n){var s=this;if(G(n)){y(n,function(p){s._addPlugin(p)});return}var c=De(this.plugins,function(p){return n===p});if(!c){if(this.plugins.push(n),!M(n))throw new Error("Plugins must be function values that return objects");var d=n.call(this);if(!Be(d))throw new Error("Plugins must return an object of function properties");y(d,function(p,m){if(!M(p))throw new Error("Bad plugin property: "+m+" from plugin "+n.name+". Plugins should only return functions.");s._assignPluginFnProp(p,m)})}},addStorage:function(n){We("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(n)}},u=$e(l,Xe,{plugins:[]});return u.raw={},y(u,function(n,s){M(n)&&(u.raw[s]=Ue(u,n))}),y(e,function(n){u._addStorage(n)}),y(t,function(n){u._addPlugin(n)}),u}});var Q=g(function(Rt,H){var Ke=w(),He=Ke.Global;H.exports={name:"localStorage",read:K,write:Qe,each:Ze,remove:Ye,clearAll:Ve};function S(){return He.localStorage}function K(e){return S().getItem(e)}function Qe(e,t){return S().setItem(e,t)}function Ze(e){for(var t=S().length-1;t>=0;t--){var r=S().key(t);e(K(r),r)}}function Ye(e){return S().removeItem(e)}function Ve(){return S().clear()}});var V=g(function(zt,Y){var et=w(),tt=et.Global;Y.exports={name:"oldFF-globalStorage",read:rt,write:nt,each:Z,remove:at,clearAll:it};var x=tt.globalStorage;function rt(e){return x[e]}function nt(e,t){x[e]=t}function Z(e){for(var t=x.length-1;t>=0;t--){var r=x.key(t);e(x[r],r)}}function at(e){return x.removeItem(e)}function it(){Z(function(e,t){delete x[e]})}});var re=g(function(Lt,te){var ot=w(),z=ot.Global;te.exports={name:"oldIE-userDataStorage",write:ut,read:ct,each:st,remove:ft,clearAll:lt};var P="storejs",A=z.document,F=dt(),ee=(z.navigator?z.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function ut(e,t){if(!ee){var r=L(e);F(function(i){i.setAttribute(r,t),i.save(P)})}}function ct(e){if(!ee){var t=L(e),r=null;return F(function(i){r=i.getAttribute(t)}),r}}function st(e){F(function(t){for(var r=t.XMLDocument.documentElement.attributes,i=r.length-1;i>=0;i--){var a=r[i];e(t.getAttribute(a.name),a.name)}})}function ft(e){var t=L(e);F(function(r){r.removeAttribute(t),r.save(P)})}function lt(){F(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(P);for(var r=t.length-1;r>=0;r--)e.removeAttribute(t[r].name);e.save(P)})}var pt=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function L(e){return e.replace(/^\d/,"___$&").replace(pt,"___")}function dt(){if(!A||!A.documentElement||!A.documentElement.addBehavior)return null;var e="script",t,r,i;try{r=new ActiveXObject("htmlfile"),r.open(),r.write("<"+e+">document.w=window</"+e+'><iframe src="/favicon.ico"></iframe>'),r.close(),t=r.w.frames[0].document,i=t.createElement("div")}catch(a){i=A.createElement("div"),t=A.body}return function(a){var o=[].slice.call(arguments,0);o.unshift(i),t.appendChild(i),i.addBehavior("#default#userData"),i.load(P),a.apply(this,o),t.removeChild(i)}}});var ce=g(function(Dt,ue){var ne=w(),gt=ne.Global,ht=ne.trim;ue.exports={name:"cookieStorage",read:vt,write:mt,each:ae,remove:ie,clearAll:_t};var T=gt.document;function vt(e){if(!e||!oe(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(T.cookie.replace(new RegExp(t),"$1"))}function ae(e){for(var t=T.cookie.split(/; ?/g),r=t.length-1;r>=0;r--)if(ht(t[r])){var i=t[r].split("="),a=unescape(i[0]),o=unescape(i[1]);e(o,a)}}function mt(e,t){e&&(T.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function ie(e){!e||!oe(e)||(T.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function _t(){ae(function(e,t){ie(t)})}function oe(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(T.cookie)}});var le=g(function(Ut,fe){var wt=w(),xt=wt.Global;fe.exports={name:"sessionStorage",read:se,write:bt,each:yt,remove:St,clearAll:Ot};function O(){return xt.sessionStorage}function se(e){return O().getItem(e)}function bt(e,t){return O().setItem(e,t)}function yt(e){for(var t=O().length-1;t>=0;t--){var r=O().key(t);e(se(r),r)}}function St(e){return O().removeItem(e)}function Ot(){return O().clear()}});var de=g(function($t,pe){pe.exports={name:"memoryStorage",read:At,write:Pt,each:jt,remove:Ft,clearAll:Tt};var b={};function At(e){return b[e]}function Pt(e,t){b[e]=t}function jt(e){for(var t in b)b.hasOwnProperty(t)&&e(b[t],t)}function Ft(e){delete b[e]}function Tt(e){b={}}});var he=g(function(Bt,ge){ge.exports=[Q(),V(),re(),ce(),le(),de()]});var ve=g(function(exports,module){typeof JSON!="object"&&(JSON={});(function(){"use strict";var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(e){return e<10?"0"+e:e}function this_value(){return this.valueOf()}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(t){var r=meta[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,i,a,o,l=gap,u,n=t[e];switch(n&&typeof n=="object"&&typeof n.toJSON=="function"&&(n=n.toJSON(e)),typeof rep=="function"&&(n=rep.call(t,e,n)),typeof n){case"string":return quote(n);case"number":return isFinite(n)?String(n):"null";case"boolean":case"null":return String(n);case"object":if(!n)return"null";if(gap+=indent,u=[],Object.prototype.toString.apply(n)==="[object Array]"){for(o=n.length,r=0;r<o;r+=1)u[r]=str(r,n)||"null";return a=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+l+"]":"["+u.join(",")+"]",gap=l,a}if(rep&&typeof rep=="object")for(o=rep.length,r=0;r<o;r+=1)typeof rep[r]=="string"&&(i=rep[r],a=str(i,n),a&&u.push(quote(i)+(gap?": ":":")+a));else for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(a=str(i,n),a&&u.push(quote(i)+(gap?": ":":")+a));return a=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+l+"}":"{"+u.join(",")+"}",gap=l,a}}typeof JSON.stringify!="function"&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var i;if(gap="",indent="",typeof r=="number")for(i=0;i<r;i+=1)indent+=" ";else typeof r=="string"&&(indent=r);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":e})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var r,i,a=e[t];if(a&&typeof a=="object")for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=walk(a,r),i!==void 0?a[r]=i:delete a[r]);return reviver.call(e,t,a)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})()});var _e=g(function(Xt,me){me.exports=kt;function kt(){return ve(),{}}});var xe=g(function(Wt,we){var qt=W(),Et=he(),Jt=[_e()];we.exports=qt.createStore(Et,Jt)});var Ct={};Fe(Ct,{osmAuth:function(){return Nt}});var q=Te(xe(),1);function Nt(e){var t={};t.authenticated=function(){return!!r("oauth2_access_token")},t.logout=function(){return r("oauth2_access_token",""),r("oauth_token",""),r("oauth_token_secret",""),r("oauth_request_token_secret",""),t},t.authenticate=function(a){if(t.authenticated()){a(null,t);return}t.logout();var o=e.url+"/oauth2/authorize?"+D({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope});if(e.singlepage){var l=be(window.location.search.slice(1));l.code?p(l.code):window.location=o}else{var u=600,n=550,s=[["width",u],["height",n],["left",window.screen.width/2-u/2],["top",window.screen.height/2-n/2]].map(function(h){return h.join("=")}).join(","),c=window.open("about:blank","oauth_window",s);if(t.popupWindow=c,c.location=o,!c){var d=new Error("Popup was blocked");throw d.status="popup-blocked",d}}window.authComplete=function(h){var _=be(h.split("?")[1]);p(_.code),delete window.authComplete};function p(h){var _=e.url+"/oauth2/token?"+D({client_id:e.client_id,grant_type:"authorization_code",code:h,redirect_uri:e.redirect_uri,client_secret:e.client_secret});t.rawxhr("POST",_,null,null,null,m),e.loading()}function m(h,_){if(e.done(),h){a(h);return}var E=JSON.parse(_.response);r("oauth2_access_token",E.access_token),a(null,t)}},t.bringPopupWindowToFront=function(){var a=!1;try{t.popupWindow&&!t.popupWindow.closed&&(t.popupWindow.focus(),a=!0)}catch(o){}return a},t.bootstrapToken=function(a,o){function l(n){var s=e.url+"/oauth2/token?"+D({client_id:e.client_id,grant_type:"authorization_code",code:n,redirect_uri:e.redirect_uri,client_secret:e.client_secret});t.rawxhr("POST",s,null,null,null,u),e.loading()}function u(n,s){if(e.done(),n){o(n);return}var c=JSON.parse(s.response);r("oauth2_access_token",c.access_token),o(null,t)}l(a)},t.fetch=function(a,o,l){if(t.authenticated())return u();if(e.auto){t.authenticate(u);return}else{l("not authenticated",null);return}function u(){var n=o.prefix!==!1?e.url+a:a,s=o.headers||{"Content-Type":"application/x-www-form-urlencoded"};return s.Authorization="Bearer "+r("oauth2_access_token"),fetch(n,{method:o.method,body:o.body,headers:s}).then(function(c){var d=c.headers.get("content-type").split(";")[0];switch(d){case"text/html":case"text/xml":return c.text().then(function(p){return new window.DOMParser().parseFromString(p,d)});case"application/html":return c.json();default:return c.text()}})}},t.xhr=function(a,o){if(t.authenticated())return l();if(e.auto){t.authenticate(l);return}else{o("not authenticated",null);return}function l(){var n=a.prefix!==!1?e.url+a.path:a.path;return t.rawxhr(a.method,n,r("oauth2_access_token"),a.content,a.headers,u)}function u(n,s){n?o(n):s.responseXML?o(n,s.responseXML):o(n,s.response)}},t.rawxhr=function(a,o,l,u,n,s){n=n||{"Content-Type":"application/x-www-form-urlencoded"},l&&(n.Authorization="Bearer "+l);var c=new XMLHttpRequest;c.onreadystatechange=function(){c.readyState===4&&c.status!==0&&(/^20\d$/.test(c.status)?s(null,c):s(c,null))},c.onerror=function(p){s(p,null)},c.open(a,o,!0);for(var d in n)c.setRequestHeader(d,n[d]);return c.send(u),c},t.preauth=function(a){return a&&a.access_token&&r("oauth2_access_token",a.access_token),t},t.options=function(a){return arguments.length?(e=a,e.url=e.url||"https://www.openstreetmap.org",e.auto=e.auto||!1,e.singlepage=e.singlepage||!1,e.loading=e.loading||function(){},e.done=e.done||function(){},t.preauth(e)):e};var r;if(q.default.enabled)r=function(a,o){if(arguments.length===1)return q.default.get(e.url+a);if(arguments.length===2)return q.default.set(e.url+a,o)};else{var i={};r=function(a,o){if(arguments.length===1)return i[e.url+a];if(arguments.length===2)return i[e.url+a]=o}}return t.options(e),t}function D(e){return Object.keys(e).sort().map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function be(e){for(var t=0;t<e.length&&(e[t]==="?"||e[t]==="#");)t++;return e=e.slice(t),e.split("&").reduce(function(r,i){var a=i.split("=");return a.length===2&&(r[a[0]]=decodeURIComponent(a[1])),r},{})}return ke(Ct);})();
//# sourceMappingURL=osm-auth.iife.js.map
